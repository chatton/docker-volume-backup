services:
  docker-volume-backup:
    container_name: docker-volume-backup
    build:
      context: .
    command:
      - periodic-backups
      - --cron
      - "* * * * *"
      - --host-path
      - ${BACKUP_HOST_PATH}
      - --retention-days
      - "7"
      - --mode
      - "s3"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${BACKUP_HOST_PATH}:/backups
    environment:
      AWS_ACCESS_KEY_ID: "Qrzl4TgFeGpIOEORbjIv"
      AWS_SECRET_ACCESS_KEY: "INOBdORoOawOCHSLseek8x97sWZcQ9SgDU6pS1eL"
      AWS_DEFAULT_REGION: "us-east-1"
      AWS_BUCKET: "backups"
      AWS_ENDPOINT: "l8x8.ie11.idrivee2-6.com"

  audiobookshelf:
    labels:
      ie.cianhatton.backup.enabled: "true"
      ie.cianhatton.backup.volumes: "docker-volume-backup_config,docker-volume-backup_metadata"
    container_name: audiobookshelf
    image: ghcr.io/advplyr/audiobookshelf:latest
    environment:
      - AUDIOBOOKSHELF_UID=99
      - AUDIOBOOKSHELF_GID=100
    ports:
      - 13378:80
    volumes:
      - ${AUDIO_BOOKS_DIRECTORY}:/audiobooks
      - ${PODCASTS_DIRECTORY}:/podcasts
      - config:/config
      - metadata:/metadata
volumes:
  config:
  metadata:
